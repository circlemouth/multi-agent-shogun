# Charts 情報設計 比較表（A/B/C）
RUN_ID=20260206T141412Z-cmd_20260206_21_sub_1-charts-ia

要件（抜粋）:
- 中央SOAP最大化（縦/横）
- 左=過去カルテ記載 + 過去オーダー参照
- 左の各行/カードに Do処方/Doオーダー ボタン
- 過去記載（S/O/A/P等）を Doで現在SOAPへ転記（プレビュー + Undo）

前提観測（参考）:
- 1440x900 で SOAP 到達が下方向スクロール必須、centerWidth は約 613px（別RUNの計測結果）。

---

| 観点 | 案A: 左=Past Hub 統合リスト | 案B: Past Hub + Doキュー（ステージング） | 案C: Past Hub + 中央Splitプレビュー |
| --- | --- | --- | --- |
| 中央SOAPの有効サイズ（縦/横） | 高（右を常時表示しない前提で確保しやすい） | 高（同上、Queueは小さく可変にできる） | 通常=高 / プレビュー時=中（Splitで一時的に狭くなる） |
| 過去参照の探索性（記載/オーダー） | 高（統合+タブ+検索で到達が速い） | 中〜高（Queue導入で一覧UIは軽いが、Queue理解が必要） | 中（一覧は軽いが詳細はSplitに依存） |
| Do操作の操作回数/誤操作リスク | 操作回数=少 / 誤操作=中（即時適用に寄りやすいのでプレビュー必須） | 操作回数=中 / 誤操作=低（ステージングで強制レビュー） | 操作回数=中 / 誤操作=低（Splitで見ながら適用） |
| 転記プレビュー/Undoの設計容易性 | 中（差分UIを作る必要、Undoは1世代で現実的） | 中〜高（Queue item 単位にプレビュー/適用/取消を集約できる） | 中（Splitは分かりやすいが、レイアウト/フォーカスの考慮が増える） |
| 実装コスト/回帰リスク | 低〜中（左パネル追加+既存copy機能の呼び出し中心） | 中（Queue状態管理とUI追加） | 中〜高（Split UI, スクロール/フォーカス/レスポンシブの難度） |
| 段階導入（flag） | 容易（左の表示/Doの有効化を分けられる） | 中（Queue有効化で体験が変わる） | 中（Splitを入れると体験が大きく変わる） |

---

## 推奨案
推奨: **案A**
- 理由: 既存資産（PatientsTabの履歴、OrderBundleの履歴コピー、Documentのreuse）を活かしつつ、左に「参照 + Do」を集約できる。
- 中央SOAP最大化との相性が良く、まずは"左で過去参照"の改善から段階導入できる。

次点:
- 誤操作が多い現場なら案B（ステージング）が強い。ただしUI理解コスト/実装コストが増える。

---

## 段階導入（flag）案
必須フラグ:
- `VITE_CHARTS_PAST_PANEL=1`
  - ON: 左カラムに Past Hub（過去記載/過去オーダー）を表示（閲覧のみ）
  - OFF: 既存PatientsTab中心

- `VITE_CHARTS_DO_COPY=1`
  - ON: Past Hub の各行に Do（記載転記/処方/オーダー）を表示し、プレビュー→適用→Undo を有効化
  - OFF: Doボタンは表示しない（あるいは disabled で"段階導入中"表示）

推奨ロールアウト:
1. Phase1: `VITE_CHARTS_PAST_PANEL=1`, `VITE_CHARTS_DO_COPY=0`
   - 過去参照を左に集約（閲覧のみ）
2. Phase2: `VITE_CHARTS_PAST_PANEL=1`, `VITE_CHARTS_DO_COPY=1`（限定ユーザー/施設）
   - Doを解放（プレビュー+Undoを必須）
3. Phase3: デフォルトON（運用でUndo/誤操作データを見て案B要否を判断）
